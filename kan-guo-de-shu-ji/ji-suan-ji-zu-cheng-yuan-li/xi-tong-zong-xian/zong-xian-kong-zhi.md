* 总线在同一时刻只能由一对设备进行使用

### 总线判优控制

#### 基本概念

* 主设备\(模块\):对总线有`控制权`
* 从设备\(模块\):`响应`从主设备发来的总线命令

* 总线判优控制

  * 集中式

    * 链式查询

      * 结构特别简单

      ![](/assets/js-14.2.3.5-1.png)

      * 距离总线近的优先级高

      * 电路故障敏感

      * 增删设备容易

      * 优先级算法简单

      * 比较可靠性比较容易实现

      ```
      在链式查询方式下，若有N个设备，则只有一条总线请求线
      ```

    * 计数器定时查询

      * 地址线用于从设备的查找

      * 数据线用于数据的传输

      * 设备地址:地址由计数器给出

      ![](/assets/js-14.2.3.5-8.png)

      * 优先级确定比较灵活

```
      从上一次停止计数开始，优先级-->循环优先级，则所有设备优先级相同
      从0开始，则由设备号越大优先级越低
```

* 独立请求方式

  * 速度快
  * 可编程实现优先级更改
  * 线路条数多，控制最复杂
  * 每一台设备均由一对总线请求线

  ![](/assets/js-14.2.3.5-9.png)

  * 分布式

### 总线通信控制

* 目的:解决通信双方协调配合问题
* 总线传输周期
  * 申请分配阶段:主模块申请，总线仲裁决定
  * 寻址阶段:主模块向从模块给出地址和命令
  * 传数阶段:主模块和从模块交换数据
  * 结束阶段:主模块撤销有关信息

### 总线通信的四种方式

* 同步通信:由统一时标控制数据传送
  ```
  在同步通信中，一个总线周期的传输过程是 先传输地址，在传输数据
  ```
* 异步通信:采用应答方式，没有公共时钟标准

  * 请求线、应答线\(请求和握手信号\)
  * 请求方式

    * 不互锁
    * 半互锁
    * 全互锁:可以解决半互锁的问题

    ![](/assets/js-14.2.3.5-10.png)

* 半同步通信:同步、异步结合

  * 同步
    * 发送方用系统时钟前沿发信号
    * 接收方用系统时钟后沿 判断、识别
  * 异步
    * 允许不同速度的模块和谐工作
    * 增加一条"等待"响应信号WAIT

* 以上三个方式的共同特点

  * 主模块发地址、命令
    * 占用总线
  * 从模块准备数据
    * 不占用数据、总线空闲
  * 从模块向主模块发数据
    * 占用总线

* 分离式通信:充分挖掘系统总线每个瞬间的潜力

  * 一个总线传输周期

    * 子周期1
      * 主模块申请占用总线，使用完后即放弃总线的使用权
    * 子周期2
      * 从模块\(主模块\)申请占用总线，将各种信息送至总线上

    ```
    在 分离式通信中 ，总线上所有模块都可以成为模块
    ```

  * 分类式通信特点

    * 各模块有权申请占用总线
    * 采用同步方式通信，不等对方回答
    * 各模块准备数据时，不占用总线
    * 总线被占用时，无空闲
    * 充分提高了总线的有效占用

---

总线通信控制主要解决通信双方如何获知传输开始和传输结束，以及通信双方如何协调如何配合。

通常有四种方式：同步通信、异步通信、半同步通信和分离式通信。

同步通信中，通信双方由统一时标控制数据传送。下图表示了某输入设备向CPU传输数据的同步通信过程。

图中总线传输周期是连接在总线上的两个部件完成一次完整且可靠地信息传输时间，它包含4个时钟周期T1 、T2 、T3 、T4 。在上图所示**读命令**中，T3时钟周期执行的操作是（从模块提供数据 ）

![](https://img0.ph.126.net/sPozpdm8OIf1fpTd-tSvfw==/3134786815727304465.png)

```
解析： 同步通信在系统总线设计时，对T1 、T2 、T3 、T4都有明确、唯一的规定。
对于读命令，其传输周期如下：
T1 主模块发出地址。 
T2 主模块发读命令 
T3 从模块提供数据  
T4 主模块撤销读命令，从模块撤销数据
```




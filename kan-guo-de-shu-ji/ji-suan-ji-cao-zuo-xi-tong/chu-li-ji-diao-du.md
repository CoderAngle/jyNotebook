### 知识预览

* 处理机调度
  * 基本概念
    * 高级调度\(作业调度\)
    * 中级调度\(内存调度\)
    * 低级调度\(进程调度\)
  * 三个层次
  * 三层调度的联系、对比
  * 补充知识
    * 进程的"挂起态"
    * 7状态模型

---

### 调度的基本概念

1. 普通 - 先到先服务
   特殊 - 可优先服务
2. 时间短的优先
   时间相同的先排队先使用

```
有限资源内，没法同时处理这些事情，这就需要确定某种规则来决定处理任务的顺序，这就是
"调度"研究的问题
```

---

### 调度的三个层次

#### 高级调度

* 高级调度\(作业调度\)
  * 按一定的原则从外存上处于后备队列的作业中挑选一个\(或多个\)作业，给他们分配内存等必要资源，并建立相应的进程\(建立PCB\)，以使它\(们\)获得竞争处理价的权利
  * 高级调度是辅存\(外存\)与内存之间的调度。每个作业只调度入一次，调出一次。作业调入时会建立相应的PCB，作业调出时才撤销PCB。高级调度主要是指调入的问题， 因为只有调入的时机需要操作系统来确定，但调出的时机必然是作业运行结束才调出。

#### 中级调度

```
引入虚拟存储技术之后，可将暂时不能运行的进程调至外存等待。等它重新具备了运行条件
且内存有稍有空闲时，再重新调度内存

这么做的目的是为了提高内存利用率和系统吞吐量

暂时调度外存等待的进程状态为挂起状态
```

* 中级调度\(内存调度\)
  * 就是决定将哪个处于挂起状态的进程重新调入内存
  * 一个进程可能会多次调出、调入内存，因此中级调度发生的频率要比高级调度更高

#### 进程的挂起态与7状态模型

暂时调到外存等待的进程状态为挂起状态\(挂起态\)

挂起态又可以进一步细分为就绪挂起、阻塞挂起两种状态

![](/assets/13.3.6-2.png)

#### 低级调度

* 低级调度\(进程调度\)，其主要任务是按照某种方法和策略从就绪队列中选取一个进程，将处理机分配给它

* 进程调度是操作系统中最基本的一种调度，在一般的操作系统中都必须配置进程调度

#### 三次调度的联系、对比

|  | 要做什么 | 调度发生在什么 | 发生频率 | 对进程状态的影响 |
| :--- | :--- | :--- | :--- | :--- |
| 高级调度\(作业调度\) | 按照某种规则，从后备队列中选择合适的作业将其调入内存，并为其创建进程 | 外存-&gt;内存\(面向作业\) | 最低 | 无-&gt;创建态-&gt;就绪态 |
| 中级调度\(内存调度\) | 按照某种规则，从挂起队列中选择合适的进程将其数据调回内存 | 外存-&gt;内存\(面向进程\) | 中等 | 挂起态-&gt;就绪态\(阻塞挂起-&gt;阻塞态\) |
| 低级调度\(进程调度\) | 按照某种规则，从就绪队列中选择一个进程为其分配处理机 | 内存-&gt;cpu | 最高 | 就绪态-&gt;运行态 |

#### 知识点

* 处理机调度
  * 基本概念
    * 按某种算法选择一个进程将处理机分配给它
  * 三个层次
    * 高级调度\(作业调度\):按照某种规则，从后备队列中选择合适的作业将其调入内存，并为其创建进程
    * 中级调度\(内存调度\):按照某种规则，从挂起队列中选择合适的进程将其数据调回内存
    * 低级调度\(进程调度\):按照某种规则，从就绪队列中选择一个进程为其分配处理机
  * 三层调度的联系、对比
    * 高级调度
      * 外存-&gt;内存\(面向作业\)
      * 发送频率:最低
    * 中级调度
      * 外存-&gt;内存\(面向进程\)
      * 发送频率:中等
    * 低级调度
      * 内存-&gt;cpu
      * 发送频率:最高
  * 补充知识
    * 为减轻系统负载，提高资源利用率，暂时不执行的进程会被调用外存从而变为"挂起态"
    * 七状态模型:在五状态模型的基础上加入了"就绪挂起"和"阻塞挂起"的两种状态

---

### 进程调度的时机、切换与过程调度方式

* 进程调度
  * 时机
    * 什么时候需要进程调度?
    * 什么时候不能进行调度?
  * 切换与过程
    * “狭义的调度”与"切换"的区别
    * 进程切换的过程需要做什么?
  * 方式
    * 非剥夺调度方式\(非抢占式\)
    * 剥夺调度方式\(抢占式\)

### 进程调度的时机

* 进程调度\(低级调度\)，就是按照某种算法从就绪队列中选择一个进程为其分配处理机

![](/assets/13.3.6-3.png)

* 不能进行进程调度与切换的情况
  1. 在处理中断的过程中。中断处理过程复杂，与硬件密切相关，很难做到在中断处理过程中进行进程切换
  2. 进程在操作系统内核程序临界区中
  3. 在原子操作过程中\(原语\)。原子操作不可中断，要一起呵成\(如之前讲过的修改PCB中进程状态标志，并把PCB放到相应队列\)

```
进程在操作内核程序临界区中不能进行调度与切换(对的)

2012年联考真题 进程处于临界区时不能进行处理机调度(错的)
```

* 临街资源:一个时间段内只允许一个进程使用的资源。各进程需要互斥地访问临街资源
* 临界区:访问临街资源的那段代码
* 内核程序临界区:一般是同来访问某种内核数据结构的，比如进程的就绪队列\(由各就绪进程的PCB组成\)

### 进程调度的方式

* 非剥夺调度方式，又称非强占方式。即，只允许进程主动放弃处理机。在运行过程中即便有更紧迫的任务到达，当前进程依然会继续使用处理机，直到该进程或主动要求进入阻塞状态
  * 实现简单，系统开销小但是无法及时处理紧急任务，适合于早期的批处理系统
* 剥夺调度方式，又称强占方式。当一个进程正在处理机上执行时，如果有一个重要或更紧迫的进程需要使用处理机，则立即暂停正在执行的进程，将处理机分配给更重要紧迫的那个进程
  * 可以优先处理更紧急的进程，也可实现让各进程按时间片轮流执行的功能\(通过时钟中断\)。适合于分时操作系统、实时操作系统

#### "狭义的进程调度"与"进程切换"的区别

* 狭义的进程调度指的是从就绪队列中选中一个要运行的进程\(这个进程可以是刚刚被暂停执行的进程，也可能是另一个进程，后一种情况就需要进程切换\)
* 进程切换是指一个进程让出处理机，由另一个进程占用处理机的过程
* 广义的进程调度包含了选择一个进程和进程切换两个步骤

```
进程切换过程:
    对原来运行进程各种数据的保存
    对新的进程各种数据的恢复
```

### 知识点

* 进程调度
  * 时机
    * 什么时候需要进程调度
      * 主动放弃
        * 进程正常终止
        * 运行过程中发生异常而终止
        * 主动阻塞\(如，等待I/O\)
      * 被动放弃
        * 分给进程的时间片用完
        * 有更紧急的事情需要处理\(如I/O中断\)
        * 有更高优先级的进程进入就绪队列
    * 什么时候不能进行进程调度?
      * 在处理中断的过程中
      * 进程在操作系统内核程序临界区中
      * 原子操作过程中\(原语\)
  * 切换与过程
    * 狭义的"调度"和切换的区别
    * 切换过程
      * 对原理运行进程各种数据的保存
      * 对新的进程各种数据的恢复
    * 重要结论:进程调度、切换是有代价的，并不是调度越频繁，并发度就越高
  * 方式
    * 非剥夺调度方式\(非抢占方式\)
      * 只能由当前运行的进程主动放弃CPU
    * 剥夺调度方式\(抢占式\)
      * 当一个进程正在处理机上执行时，如果有一个重要或更紧迫的进程需要使用处理机，则立即暂停正在执行的进程，将处理机分配给更重要紧迫的那个进程

### 调度算法的评价指标

* cpu利用率:指CPU“忙碌”的时间占总时间的比例
* 系统吞吐量:单位时间内完成作业的数量
  * ```
    系统吞吐量 = 总共完成了多少道作业 / 总共花了多少时间
    ```
* 周转时间:是指从作业被提交给系统开始，到作业完成为止的这段时间间隔

  * 周转时间、平均周转时间

    * 周转时间 = 作业完成时间 - 作业提交时间

    * 平均周转时间 = 各作业周转时间之和 / 作业数

  * 带权周转时间、平均带权周转时间

    * 带权周转时间 = 作业周转时间 / 作业实际运行的时间 = \(作业完成时间 - 作业提交事件\) / 作业实际运行的时间
    * 平均带权周转时间 = 各作业带权周转时间之和 / 作业数

* 等待时间:指进程/作业处于等待处理机状态时间之和，等待时间越长，用户满意度越低

* 响应时间:指从用户提交请求到首次产生响应所用的时间

### 知识点

* 调度算法的评价指标

  * cpu利用率
    * 也有题目会让计算某设备的利用率
    * 利用率 = 忙碌的时间 / 总时间
  * 系统吞吐量
    * 系统吞吐量 = 总共完成了多少道作业 / 总共花了多少时间
  * 周转时间

    * 平均周转时间 = 各作业周转时间之和 / 作业数
    * 带权周转时间 = 作业周转时间 / 作业实际运行的时间
    * 平均带权周转时间 = 各作业带权周转时间之和 / 作业数

  * 等待时间

    * 进程/作业 等待被服务的时间之和
    * 平均等待时间即各个 进程/作业 等待时间的平均值

  * 响应时间

    * 从用户提交请求到首次产生响应所用的时间

---

### 调度算法

* 先来先服务
* 最短作业优先
* 最高响应优先比



